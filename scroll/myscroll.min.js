(function(win,doc){var _num=20;function myScroll(id,num){this.id=id;this.num=num||_num;this.flag=false;this.obj="";this.cpro="";this.progress_div="";this.mdiv="";this.p_height="";this.ph="";this.ah="";this._init();this._handleScroll()}myScroll.prototype={_init:function(){if(!this.id){throw new Error('"id" is necessary!')}this.obj=$("#"+this.id);if(this.obj.css("display")=="none"){this.obj.css("display","block");if(this.obj.css("max-height")=="none"){this.ph=this.obj[0].clientHeight}else{this.ph=this._handlePx(this.obj.css("max-height"))}this.ah=this.obj[0].scrollHeight;this.obj.css("display","none")}else{this.ph=this.obj[0].clientHeight;this.ah=this.obj[0].scrollHeight}this.obj.css("height",this.ph+"px")},_handleScroll:function(){if(this.ah>this.ph){this.obj.css({"position":"relative","overflow":"hidden"});this._addPNode();this._addProgress();this._handleWheel();this._handleChange()}else{return}},_addPNode:function(){var _inner=this.obj[0].children;var _length=_inner.length;var _outerDiv=$('<div class="my-Outer-div"></div>');this.mdiv=_outerDiv;_outerDiv.append(_inner);this.obj.append(_outerDiv)},_addProgress:function(){var _height=this.ph/this.ah*this.ph;var _ipro=$('<div class="myScroll-progress-div"></div>');var _tspan=$('<span class="myScroll-progress-tspan"></span>');var _cspan=$('<span class="myScroll-progress-cspan"></span>');_cspan.css("height",_height+"px");this.p_height=_height;this.cpro=_cspan;this.progress_div=_ipro;_ipro.append(_tspan);_ipro.append(_cspan);this.obj.append(_ipro)},_handleWheel:function(){var that=this;var be=0;var be1=0;this.obj.hover(function(){var H2=that.ah;if(that.flag){H2=that.mdiv.height();that.flag=false}var H1=that.ph;var H3=that.p_height;be=H2-H1;be1=H1-H3;var _step=that.num/be*be1;$("body").css({"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","-khtml-user-select":"none","user-select":"none"});$(this).on("mousewheel",function(e){e.preventDefault();var _val=e.originalEvent.wheelDelta;var _top=that.mdiv.position().top;var _pro_top=that.cpro.position().top;if(_val<0){_top=_top-that.num;_pro_top=_pro_top+_step;if(Math.abs(_top)>be){_top=-be}_pro_top=_pro_top>be1?be1:_pro_top}else{_top=_top+that.num;_pro_top=_pro_top-_step;if(_top>0){_top=0}_pro_top=_pro_top<0?0:_pro_top}that.mdiv.css("top",_top+"px");that.cpro.css("top",_pro_top+"px")})},function(){$("body").css({"-moz-user-select":"auto","-webkit-user-select":"auto","-ms-user-select":"auto","-khtml-user-select":"auto","user-select":"auto"});$(this).off("mousewheel")});that.progress_div.on("mousedown",function(e){var $that=$(this);var _startY=e.pageY;var _move=0;var _pro_move=0;var _main_move=0;$(this).on("mousemove",function(e){var _endY=e.pageY;_move=_endY-_startY;_pro_move=that.cpro.position().top+_move/10;_main_move=that.mdiv.position().top-_move/(be1/be)/10;if(_pro_move<0){that.cpro.css("top",0+"px");that.mdiv.css("top",0+"px")}else{if(_pro_move>be1){that.cpro.css("top",be1+"px");that.mdiv.css("top",-be+"px")}else{that.cpro.css("top",_pro_move+"px");that.mdiv.css("top",_main_move+"px")}}})}).on("mouseout",function(){$(this).off("mousemove")}).on("mouseup",function(){$(this).off("mousemove")})},_handleChange:function(){var that=this;this.obj.on("DOMNodeRemoved",function(){setTimeout(function(){if(that.mdiv.height()<that.ph){that.progress_div.css("display","none")}else{var _nheight=that.ph/that.mdiv.height()*that.ph;that.p_height=_nheight;that.cpro.css("height",_nheight+"px");that.progress_div.css("height",that.mdiv.height()+"px");that.ah=that.mdiv.height()}that.flag=true},1)}).on("DOMNodeInserted",function(){setTimeout(function(){if(that.mdiv.height()<that.ph){that.progress_div.css("display","none")}else{var _nheight=that.ph/that.mdiv.height()*that.ph;that.p_height=_nheight;that.cpro.css("height",_nheight+"px");that.progress_div.css("height",that.mdiv.height()+"px");that.ah=that.mdiv.height()}that.flag=true},1)})},_handlePx:function(str){var newStr=str.split("p")[0]-0;return newStr}};if(typeof module!=="undefined"&&module.exports){module.exports=myScroll}if(typeof define==="function"){define(function(){return myScroll})}win.myScroll=myScroll}(window,document));